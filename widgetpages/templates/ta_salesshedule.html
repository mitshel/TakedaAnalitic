{% extends "ta_layout.html" %}
{% load staticfiles %}
{% load i18n %}

{% block page %}
<script src="{% static  "highcharts/code/highcharts.js" %}"></script>
<script src="{% static  "highcharts/code/modules/series-label.js" %}"></script>
<script src="{% static  "highcharts/code/modules/exporting.js" %}"></script>
<script src="{% static  "highcharts/code/modules/export-data.js" %}"></script>

<div class="row" id="container1"></div>

    <script type="text/javascript">

        Highcharts.chart('container1', {

            title: {
                text: 'График продаж по рынку'
            },

            yAxis: {
                title: {
                    text: 'Стоимость продукта (суммарно по годам)'
                }
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle'
            },

            plotOptions: {
                series: {
                    label: {
                        connectorAllowed: false
                    },
                    pointStart: {{ year_min }}
                }
            },

            series: [
                {% for p in pivot %}
                    {
                        name: '{{ p.name }}',
                        data: [
                            {% for d in p.data %}{{ d.product_cost_sum|floatformat:"0" }}{% if not forloop.last %},{% endif %}{% endfor %}
                        ]
                    }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],

            responsive: {
                rules: [{
                    condition: {
                        maxWidth: 500
                    },
                    chartOptions: {
                        legend: {
                            layout: 'horizontal',
                            align: 'center',
                            verticalAlign: 'bottom'
                        }
                    }
                }]
            }

        });
    </script>
{%  endblock %}