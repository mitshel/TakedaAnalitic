{% extends "dl_layout.html" %}
{% load staticfiles %}
{% load i18n %}

{% block page %}
<style>
/* Button */
 .btn-df {
 font-size: 12px;
 padding: 2px 5px;
 border-radius: 20px;
 font-weight: bold;
 letter-spacing: 1px;
 text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.14);
 text-transform: uppercase;
 box-shadow: 0 4px 9px 0 rgba(0, 0, 0, 0.2);
}

.lh-1 {
    font-size: 0.9em;
    line-height: 1.2 !important;
    padding-top: 0.2em;
    padding-bottom: 0.1em;
}

.input-group-xs > .form-control,
.input-group-xs > .input-group-text,
.input-group-xs > .input-group-prepend .btn,
.input-group-xs > .input-group-prepend .dropdown-item,
.input-group-xs > .input-group-prepend > .dropdown-menu > .dropdown-item,
.input-group-xs > .input-group-prepend > .popover,
.input-group-xs > .input-group-append select,
.input-group-xs > .input-group-append option,
.input-group-xs > select2,
span.select2-selection__rendered
{
  height: 22px; !important;
  padding: 2px 5px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}

.input-group-xs > .input-group-prepend> .form-control {
    font-weight: bold;
}

.dx-g-bs4-filter-selector-icon {
    width: 16px;
    height: 16px;
    fill: currentColor;
}
.d-block {
    display: block !important;
}

.ui-datepicker { font-size: 9pt !important; }

.input-group-xs > .select-2-container { width: 100% !important; }
li.select2-selection__choice {
    margin: 0px 0px 0px 3px; !important;
    padding: 1px 20px 0px 3px; !important;
}

.select2-container--default .select2-selection--multiple {
    min-height: 22px; !important;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice {
    margin: 2px 0px 0px 2px; !important;
    padding: 0 2px;
    font-size: 12px;
}
.select2-container .select2-search--inline .select2-search__field {
    font-size: 12px;
    padding: 0px 5px 0px 5px;
}
.select2-container--default .select2-selection--multiple .select2-selection__rendered {
    margin: 0;
    padding: 0 0px;
    width: 100%;
}
.input-group-xs .select2-results,
ul.select2-results__options
{
  padding: 2px 5px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}

.input-group-xs .select2-results, ul.select2-results__options {
    font-size: 12px;
    line-height: 1;
}

</style>

<div class="card-columns">
{%  regroup cache_fields|dictsort:"group.id" by group as fieldgroups_list  %}
    {%  for group in fieldgroups_list %}
    <div class="accordion" id="group_{{ group.grouper.id }}">
    <div class="card ml-1 mr-1">

      <div class="row card-header mr-0 ml-0 p-1" style="background-color: #ddddff;">
        <div class="col-8 text-left pl-0 ml-0">
            <h5>{{ group.grouper.name }}</h5>
        </div>
        <div class="col-4 text-right pr-0 mr-0">
              <div class="btn-group" role="group" aria-label="{{ group.grouper.id }}_bg">
              <button type="button" id="{{ group.grouper.id }}_gcheck" class="btn btn-df btn-outline-primary active"  data-group="{{ group.grouper.id }}" data-type="gcheck" data-toggle="button" aria-pressed="true" autocomplete="off" title="Уст/снять выгрузки"><i class="fa fa-check"></i></button>
              <button type="button" id="{{ group.grouper.id }}_gfilter" class="btn btn-df btn-outline-primary" data-group="{{ group.grouper.id }}" data-type="gfilter" data-toggle="button" aria-pressed="true" autocomplete="off" title="Уст/снять фильтры"><i class="fa fa-filter"></i></button>
              </div>
        </div>
      </div>

        <div class="card-body p-0">
            <ul class="list-group list-group-flush p-0">
                {%  for field in group.list %}
                    <li class="list-group-item lh-1">
                          <div class="row">
                          <div class="col-9 text-left pl-0">
                                <a class="collapsed" id="{{ field.name }}_title" data-toggle="collapse" data-target="#{{ field.name }}_data" aria-expanded="true" aria-controls="{{ field.name }}_data">
                                  {{ field.title }}
                                </a>
                          </div>
                          <div class="col-3 text-right pr-0">
                              <div class="btn-group" role="group" aria-label="{{ field.name }}_bg">
                              <button type="button" id="{{ field.name }}_check" class="btn btn-df btn-outline-primary active"  data-group="{{ group.grouper.id }}" data-type="check" field_name="{{ field.name }}" data-toggle="button" aria-pressed="true" autocomplete="off" title="Выгружать"><i class="fa fa-check"></i></button>
                              <button type="button" id="{{ field.name }}_filter" class="btn btn-df btn-outline-primary" data-group="{{ group.grouper.id }}" data-type="filter" field_name="{{ field.name }}" data-toggle="button" aria-pressed="true" autocomplete="off" title="Фильтр по полю"><i class="fa fa-filter"></i></button>
                              </div>
                          </div>
                          </div>
                        <div id="{{ field.name }}_data" class="collapse" aria-labelledby="group_{{ group.grouper.id }}" data-parent="#group_{{ group.grouper.id }}">
                            <div class="row p-1 pr-5" id="{{ field.name }}_row">

                            {% if field.type == 1 or  field.type == 2 or  field.type == 3 %}
                            <div class="input-group input-group-xs" id="input-group-{{ field.name }}-0">
                              <div class="input-group-prepend">
                                <button class="btn btn-outline-secondary" id="selector-btn-{{ field.name }}-0" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" action="1">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M29.438 11.797v2.75h-26.922v-2.75h26.922zM29.438 17.406v2.75h-26.922v-2.75h26.922z"></path>
                                        </svg>
                                </button>

                                <div class="dropdown-menu">
                                   <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="1">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M29.438 11.797v2.75h-26.922v-2.75h26.922zM29.438 17.406v2.75h-26.922v-2.75h26.922z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Равно</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="2">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M16.906 11.797l3.016-6.547 2.094 1-2.547 5.547h9.969v2.75h-11.234l-1.328 2.859h12.563v2.75h-13.828l-2.875 6.281-2.094-0.984 2.438-5.297h-10.563v-2.75h11.828l1.297-2.859h-13.125v-2.75h14.391z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Не равно</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="3">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M24.125 16.047l-14.906 8.625-1.375-2.375 10.781-6.25-10.781-6.234 1.375-2.375z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Больше</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="4">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M23.031 14.328l-14.906 8.625-1.375-2.375 10.797-6.25-10.797-6.234 1.375-2.375zM23.828 15.641l1.375 2.391-14.938 8.609-1.375-2.375z"></path>
                                        </svg><span class="dx-g-bs4-filter-selector-item-text">&nbsp;Больше или равно</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="5">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M22.75 7.438l1.375 2.375-10.781 6.234 10.781 6.25-1.375 2.375-14.906-8.609z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Меньше</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="6">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M23.828 5.719l1.375 2.375-10.813 6.234 10.813 6.25-1.375 2.375-14.922-8.609zM23.047 24.266l-1.375 2.375-14.922-8.609 1.375-2.391z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Меньше или равно</span>
                                    </button>
                                </div>
                              </div>

                              {% if field.type == 1 %}
                                <input type="number" class="form-control data-input" autocomplete="off" id="input-{{ field.name }}-0" onkeypress="return isInteger(event)" field_name="{{ field.name }}">
                              {% elif field.type == 2 %}
                                <input type="text" class="form-control data-input" autocomplete="off" id="input-{{ field.name }}-0" pattern="[0-9]+([\.][0-9]+)?" onkeypress="return isDecimal(event)" field_name="{{ field.name }}">
                              {% elif field.type == 3 %}
                                <input type="text" class="form-control date-control data-input" autocomplete="off" id="input-{{ field.name }}-0" pattern="\d{1,2}.\d{1,2}.\d{4}" field_name="{{ field.name }}">
                              {% else %}
                                 <input type="text" class="form-control data-input" id="input-{{ field.name }}-0" field_name="{{ field.name }}">
                              {% endif %}
                                  <div class="input-group-append">
                                        <select class="form-control add-select add-{{ field.name }}" autocomplete="off" id="add-{{ field.name }}-0" idx="0">
                                            <option value="0"></option>
                                            <option value="1">И</option>
                                            <option value="2">ИЛИ</option>
                                        </select>
                                  </div>
                            </div>
                            {% endif %}

                            {% if field.type == 4 %}
                            <div class="input-group input-group-xs" id="input-group-{{ field.name }}-0">
                              <div class="input-group-prepend">
                                <button class="btn btn-outline-secondary" id="selector-btn-{{ field.name }}-0" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" action="1">
                                    <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                        <path d="M6.094 19.563l-2.031 0.281c-0.646 0.094-1.13 0.266-1.453 0.516-0.302 0.24-0.453 0.646-0.453 1.219 0 0.438 0.138 0.799 0.414 1.086s0.664 0.419 1.164 0.398c0.708 0 1.281-0.24 1.719-0.719 0.427-0.49 0.641-1.125 0.641-1.906v-0.875zM8.234 24.641h-2.172v-1.641c-0.677 1.24-1.661 1.859-2.953 1.859-0.927 0-1.682-0.276-2.266-0.828-0.552-0.552-0.828-1.292-0.828-2.219 0-1.927 1.068-3.052 3.203-3.375l2.875-0.438c0-1.469-0.656-2.203-1.969-2.203-1.177 0-2.224 0.427-3.141 1.281v-2.078c1.010-0.656 2.198-0.984 3.563-0.984 2.458 0 3.687 1.302 3.687 3.906v6.719zM14.734 16.797c0.521-0.583 1.167-0.875 1.938-0.875 0.74 0 1.323 0.281 1.75 0.844 0.448 0.583 0.672 1.38 0.672 2.391 0 1.188-0.24 2.13-0.719 2.828-0.49 0.677-1.13 1.016-1.922 1.016-0.719 0-1.302-0.271-1.75-0.813-0.427-0.51-0.641-1.141-0.641-1.891v-1.266c-0.021-0.906 0.203-1.651 0.672-2.234zM16.969 24.859c1.375 0 2.443-0.521 3.203-1.562 0.781-1.042 1.172-2.427 1.172-4.156 0-1.542-0.354-2.771-1.063-3.688-0.688-0.958-1.651-1.438-2.891-1.438-1.427 0-2.531 0.693-3.313 2.078v-6.781h-2.156v15.328h2.172v-1.5c0.677 1.146 1.635 1.719 2.875 1.719zM22.266 6.125c0.135 0 0.245 0.063 0.328 0.188 0.104 0.073 0.156 0.182 0.156 0.328v22.953c0 0.125-0.052 0.24-0.156 0.344-0.083 0.115-0.193 0.172-0.328 0.172h-12.281c-0.146 0-0.266-0.057-0.359-0.172-0.115-0.115-0.172-0.229-0.172-0.344v-22.953c0-0.135 0.057-0.245 0.172-0.328 0.094-0.125 0.214-0.188 0.359-0.188h12.281zM31.531 24.141c-0.76 0.479-1.693 0.719-2.797 0.719-1.427 0-2.589-0.479-3.484-1.438-0.865-0.958-1.286-2.198-1.266-3.719 0-1.688 0.448-3.052 1.344-4.094 0.917-1.042 2.208-1.573 3.875-1.594 0.854 0 1.63 0.177 2.328 0.531v2.156c-0.677-0.531-1.391-0.792-2.141-0.781-0.938 0-1.714 0.339-2.328 1.016-0.594 0.677-0.891 1.552-0.891 2.625 0 1.042 0.297 1.88 0.891 2.516 0.521 0.615 1.25 0.922 2.188 0.922 0.813 0 1.573-0.297 2.281-0.891v2.031z"></path>
                                    </svg>
                                </button>

                                <div class="dropdown-menu">
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="1">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M6.094 19.563l-2.031 0.281c-0.646 0.094-1.13 0.266-1.453 0.516-0.302 0.24-0.453 0.646-0.453 1.219 0 0.438 0.138 0.799 0.414 1.086s0.664 0.419 1.164 0.398c0.708 0 1.281-0.24 1.719-0.719 0.427-0.49 0.641-1.125 0.641-1.906v-0.875zM8.234 24.641h-2.172v-1.641c-0.677 1.24-1.661 1.859-2.953 1.859-0.927 0-1.682-0.276-2.266-0.828-0.552-0.552-0.828-1.292-0.828-2.219 0-1.927 1.068-3.052 3.203-3.375l2.875-0.438c0-1.469-0.656-2.203-1.969-2.203-1.177 0-2.224 0.427-3.141 1.281v-2.078c1.010-0.656 2.198-0.984 3.563-0.984 2.458 0 3.687 1.302 3.687 3.906v6.719zM14.734 16.797c0.521-0.583 1.167-0.875 1.938-0.875 0.74 0 1.323 0.281 1.75 0.844 0.448 0.583 0.672 1.38 0.672 2.391 0 1.188-0.24 2.13-0.719 2.828-0.49 0.677-1.13 1.016-1.922 1.016-0.719 0-1.302-0.271-1.75-0.813-0.427-0.51-0.641-1.141-0.641-1.891v-1.266c-0.021-0.906 0.203-1.651 0.672-2.234zM16.969 24.859c1.375 0 2.443-0.521 3.203-1.562 0.781-1.042 1.172-2.427 1.172-4.156 0-1.542-0.354-2.771-1.063-3.688-0.688-0.958-1.651-1.438-2.891-1.438-1.427 0-2.531 0.693-3.313 2.078v-6.781h-2.156v15.328h2.172v-1.5c0.677 1.146 1.635 1.719 2.875 1.719zM22.266 6.125c0.135 0 0.245 0.063 0.328 0.188 0.104 0.073 0.156 0.182 0.156 0.328v22.953c0 0.125-0.052 0.24-0.156 0.344-0.083 0.115-0.193 0.172-0.328 0.172h-12.281c-0.146 0-0.266-0.057-0.359-0.172-0.115-0.115-0.172-0.229-0.172-0.344v-22.953c0-0.135 0.057-0.245 0.172-0.328 0.094-0.125 0.214-0.188 0.359-0.188h12.281zM31.531 24.141c-0.76 0.479-1.693 0.719-2.797 0.719-1.427 0-2.589-0.479-3.484-1.438-0.865-0.958-1.286-2.198-1.266-3.719 0-1.688 0.448-3.052 1.344-4.094 0.917-1.042 2.208-1.573 3.875-1.594 0.854 0 1.63 0.177 2.328 0.531v2.156c-0.677-0.531-1.391-0.792-2.141-0.781-0.938 0-1.714 0.339-2.328 1.016-0.594 0.677-0.891 1.552-0.891 2.625 0 1.042 0.297 1.88 0.891 2.516 0.521 0.615 1.25 0.922 2.188 0.922 0.813 0 1.573-0.297 2.281-0.891v2.031z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Содержит</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="2">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M5.828 20.469v0.328c0 0.385-0.057 0.667-0.172 0.844-0.052 0.083-0.117 0.177-0.195 0.281s-0.174 0.224-0.289 0.359c-0.458 0.521-1.031 0.771-1.719 0.75-0.521 0-0.927-0.141-1.219-0.422-0.292-0.292-0.438-0.661-0.438-1.109 0-0.156 0.010-0.273 0.031-0.352s0.052-0.141 0.094-0.188 0.094-0.086 0.156-0.117 0.141-0.078 0.234-0.141c0.031-0.031 0.078-0.070 0.141-0.117s0.146-0.086 0.25-0.117h3.125zM14.016 18.328c0.010-0.406 0.070-0.729 0.18-0.969s0.289-0.49 0.539-0.75c0.479-0.604 1.13-0.906 1.953-0.906 0.75 0 1.344 0.292 1.781 0.875 0.198 0.25 0.349 0.495 0.453 0.734s0.172 0.578 0.203 1.016h-5.109zM19.078 20.469c-0.063 0.427-0.146 0.708-0.25 0.844-0.052 0.073-0.109 0.159-0.172 0.258l-0.219 0.352c-0.469 0.688-1.135 1.031-2 1.031-0.708 0-1.297-0.271-1.766-0.813l-0.305-0.359c-0.089-0.104-0.159-0.198-0.211-0.281-0.104-0.167-0.156-0.448-0.156-0.844v-0.188h5.078zM33.344 18.328l-6.875 0c0.031-0.198 0.070-0.372 0.117-0.523s0.107-0.284 0.18-0.398 0.154-0.224 0.242-0.328l0.305-0.344c0.604-0.688 1.391-1.031 2.359-1.031 0.771 0 1.51 0.266 2.219 0.797v-2.234c-0.75-0.333-1.552-0.5-2.406-0.5-1.667 0-2.974 0.531-3.922 1.594-0.396 0.427-0.708 0.859-0.938 1.297s-0.385 0.995-0.469 1.672h-2.719c-0.021-0.719-0.117-1.31-0.289-1.773s-0.424-0.914-0.758-1.352c-0.729-0.938-1.719-1.417-2.969-1.438-1.479 0-2.615 0.708-3.406 2.125v-6.953h-2.266v9.391h-3.75v-0.594c0-2.646-1.25-3.969-3.75-3.969-1.365 0-2.583 0.328-3.656 0.984v2.125c0.99-0.865 2.063-1.297 3.219-1.297 1.344 0 2.016 0.75 2.016 2.25l-2.953 0.125c-0.25 0.021-0.487 0.070-0.711 0.148l-0.633 0.227h-3.328v2.141h1.828l-0.281 0.594c-0.073 0.135-0.109 0.37-0.109 0.703 0 0.938 0.276 1.682 0.828 2.234 0.542 0.573 1.313 0.859 2.313 0.859 1.281 0 2.297-0.635 3.047-1.906v1.656h2.172v-4.141h3.75v4.141h2.297v-1.516c0.677 1.188 1.661 1.776 2.953 1.766 1.385 0 2.464-0.531 3.234-1.594 0.302-0.385 0.557-0.792 0.766-1.219 0.198-0.385 0.339-0.911 0.422-1.578h2.703c0.021 0.708 0.141 1.25 0.359 1.625 0.115 0.198 0.253 0.401 0.414 0.609s0.346 0.427 0.555 0.656c0.906 1 2.099 1.5 3.578 1.5 1.104 0 2.057-0.245 2.859-0.734v-2.109c-0.75 0.604-1.526 0.917-2.328 0.938-0.979 0-1.74-0.318-2.281-0.953l-0.328-0.328c-0.094-0.094-0.177-0.195-0.25-0.305s-0.13-0.234-0.172-0.375-0.073-0.315-0.094-0.523h6.906v-2.141zM33.297 5.688c0.146 0 0.266 0.047 0.359 0.141 0.104 0.104 0.156 0.229 0.156 0.375v23.484c0 0.135-0.052 0.255-0.156 0.359-0.094 0.115-0.214 0.172-0.359 0.172h-35.078c-0.135 0-0.26-0.057-0.375-0.172-0.094-0.115-0.135-0.234-0.125-0.359v-23.484c0-0.104 0.042-0.229 0.125-0.375 0.104-0.094 0.229-0.141 0.375-0.141h35.078z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Не содержит</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="3">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M6.109 20.688c0 0.813-0.219 1.474-0.656 1.984-0.448 0.531-1.010 0.786-1.688 0.766-0.51 0-0.896-0.141-1.156-0.422-0.302-0.292-0.443-0.667-0.422-1.125 0-0.615 0.151-1.042 0.453-1.281 0.177-0.135 0.378-0.245 0.602-0.328s0.497-0.146 0.82-0.188l2.047-0.313v0.906zM8.203 18.063c0-2.688-1.219-4.031-3.656-4.031-1.333 0-2.51 0.339-3.531 1.016v2.141c0.917-0.885 1.948-1.328 3.094-1.328 1.333 0 2 0.766 2 2.297l-2.891 0.453c-2.115 0.333-3.161 1.516-3.141 3.547 0 0.958 0.266 1.724 0.797 2.297 0.542 0.573 1.292 0.859 2.25 0.859 1.292 0 2.26-0.641 2.906-1.922v1.688h2.172v-7.016zM14.703 16.906c0.479-0.604 1.109-0.906 1.891-0.906 0.76 0 1.344 0.297 1.75 0.891 0.438 0.615 0.656 1.443 0.656 2.484 0 1.219-0.229 2.198-0.688 2.938-0.469 0.719-1.109 1.078-1.922 1.078-0.719 0-1.286-0.281-1.703-0.844-0.448-0.542-0.672-1.208-0.672-2v-1.313c-0.010-0.938 0.219-1.714 0.688-2.328zM16.906 25.313c1.365 0 2.422-0.542 3.172-1.625 0.771-1.115 1.156-2.563 1.156-4.344 0-1.604-0.339-2.885-1.016-3.844-0.698-0.979-1.661-1.469-2.891-1.469-1.438 0-2.531 0.719-3.281 2.156v-7.078h-2.188v15.969h2.172v-1.563c0.667 1.198 1.625 1.797 2.875 1.797zM31.375 24.563c-0.75 0.5-1.672 0.75-2.766 0.75-1.427 0-2.583-0.505-3.469-1.516-0.885-0.969-1.318-2.26-1.297-3.875 0-1.74 0.464-3.161 1.391-4.266 0.927-1.063 2.198-1.604 3.813-1.625 0.844 0 1.62 0.172 2.328 0.516v2.25c-0.688-0.563-1.406-0.828-2.156-0.797-0.927 0-1.688 0.349-2.281 1.047-0.583 0.698-0.875 1.609-0.875 2.734 0 1.094 0.281 1.969 0.844 2.625 0.542 0.656 1.286 0.984 2.234 0.984 0.781 0 1.526-0.323 2.234-0.969v2.141zM22.172 5.844c0.115 0 0.224 0.052 0.328 0.156 0.094 0.125 0.141 0.25 0.141 0.375v23.844c0 0.156-0.047 0.286-0.141 0.391-0.115 0.094-0.224 0.141-0.328 0.141h-23.469c-0.125 0-0.24-0.047-0.344-0.141-0.094-0.104-0.141-0.234-0.141-0.391v-23.844c0-0.125 0.047-0.25 0.141-0.375 0.104-0.104 0.219-0.156 0.344-0.156h23.469z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Начинается с</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="4">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M6.234 19.344l-2.047 0.313c-0.625 0.083-1.104 0.26-1.438 0.531-0.302 0.24-0.453 0.651-0.453 1.234 0 0.469 0.141 0.852 0.422 1.148s0.672 0.435 1.172 0.414c0.677 0 1.234-0.25 1.672-0.75 0.448-0.51 0.672-1.167 0.672-1.969v-0.922zM8.359 24.578h-2.141v-1.656c-0.667 1.26-1.656 1.891-2.969 1.891-0.938 0-1.698-0.276-2.281-0.828-0.542-0.573-0.813-1.328-0.813-2.266 0-2.021 1.063-3.188 3.188-3.5l2.891-0.484c0-1.51-0.661-2.266-1.984-2.266-1.167 0-2.214 0.443-3.141 1.328v-2.125c1.042-0.677 2.224-1.016 3.547-1.016 2.469 0 3.703 1.333 3.703 4v6.922zM14.906 16.516c0.49-0.615 1.13-0.922 1.922-0.922 0.76 0 1.339 0.297 1.734 0.891 0.438 0.615 0.656 1.438 0.656 2.469 0 1.208-0.229 2.182-0.688 2.922-0.469 0.698-1.115 1.047-1.938 1.047-0.708 0-1.276-0.276-1.703-0.828-0.458-0.552-0.688-1.214-0.688-1.984v-1.281c-0.010-0.948 0.224-1.719 0.703-2.313zM17.125 24.813c1.354 0 2.417-0.531 3.188-1.594 0.781-1.073 1.172-2.505 1.172-4.297 0-1.604-0.349-2.87-1.047-3.797-0.698-0.979-1.661-1.469-2.891-1.469-1.438 0-2.542 0.714-3.313 2.141v-7h-2.203v15.781h2.188v-1.531c0.677 1.177 1.646 1.766 2.906 1.766zM31.688 21.969c-0.698 0.635-1.453 0.953-2.266 0.953-0.958 0-1.703-0.323-2.234-0.969-0.563-0.667-0.849-1.536-0.859-2.609 0-1.115 0.297-2.016 0.891-2.703 0.594-0.698 1.359-1.047 2.297-1.047 0.76 0 1.484 0.266 2.172 0.797v-2.219c-0.708-0.344-1.49-0.516-2.344-0.516-1.625 0-2.906 0.536-3.844 1.609-0.938 1.083-1.406 2.495-1.406 4.234 0 1.594 0.438 2.875 1.313 3.844 0.885 0.979 2.052 1.469 3.5 1.469 1.083 0 2.010-0.245 2.781-0.734v-2.109zM33.188 5.563c0.104 0 0.219 0.047 0.344 0.141 0.094 0.146 0.141 0.276 0.141 0.391v23.578c0 0.146-0.047 0.281-0.141 0.406-0.125 0.094-0.24 0.141-0.344 0.141h-23.625c-0.125 0-0.24-0.047-0.344-0.141-0.094-0.135-0.135-0.271-0.125-0.406v-23.578c0-0.115 0.042-0.245 0.125-0.391 0.094-0.094 0.208-0.141 0.344-0.141h23.625z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Заканчивается на</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="5">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M29.438 11.797v2.75h-26.922v-2.75h26.922zM29.438 17.406v2.75h-26.922v-2.75h26.922z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Равно</span>
                                    </button>
                                    <button class="dropdown-item d-flex align-items-center dx-g-bs4-cursor-pointer dx-g-bs4-filter-selector-item" parent="selector-btn-{{ field.name }}-0" action="6">
                                        <svg viewBox="0 0 32 32" class="d-block dx-g-bs4-filter-selector-icon">
                                            <path d="M16.906 11.797l3.016-6.547 2.094 1-2.547 5.547h9.969v2.75h-11.234l-1.328 2.859h12.563v2.75h-13.828l-2.875 6.281-2.094-0.984 2.438-5.297h-10.563v-2.75h11.828l1.297-2.859h-13.125v-2.75h14.391z"></path>
                                        </svg>
                                        <span class="dx-g-bs4-filter-selector-item-text">&nbsp;Не равно</span>
                                    </button>
                              </div>
                              </div>
                              <input type="text" class="form-control data-input" id="input-{{ field.name }}-0" field_name="{{ field.name }}">
                              <div class="input-group-append" id="input-{{ field.name }}-0">
                                    <select class="form-control add-select add-{{ field.name }}" autocomplete="off" id="add-{{ field.name }}-0" idx="0">
                                        <option value="0"></option>
                                        <option value="1">И</option>
                                        <option value="2">ИЛИ</option>
                                    </select>
                              </div>
                            </div>
                          {% endif %}

                          {% if field.type == 5 %}
                             <div class="input-group input-group-xs" id="input-group-{{ field.name }}-0">
                                <select data-placeholder="Выбор..." class="form-control select-2 data-input" name="states[]" multiple="multiple" id="input-{{ field.name }}-0" field_name="{{ field.name }}">
                                </select>
                             </div>
                              <script>
                                    $('#input-{{ field.name }}-0').select2({
                                      ajax: {
                                        url: function (params) { return "{% url 'data:fk' field.fk %}"+params.term; },
                                        dataType: 'json'
                                      },
                                      width: "100%"
                                    });
                              </script>
                          {% endif %}
                            <script>
                            $(function()
                            {
                                flt_counts['{{ field.name }}'] = 1;

                                $(document).on('change', '.add-{{ field.name }}', function(e)
                                {
                                    if ($(this).val()!=="0") {
                                        e.preventDefault();
                                        idx = flt_counts['{{ field.name }}'] - 1;
                                        if ($(this).attr('id') === 'add-{{ field.name }}-' + idx) {
                                            idx += 1;
                                            var controlForm = $('#{{ field.name }}_row'),
                                                currentEntry = $('#input-group-{{ field.name }}-0'),
                                                newEntry = $(currentEntry.clone());

                                            newEntry.attr('id', 'input-group-{{ field.name }}-' + idx);
                                            newEntry.find('#selector-btn-{{ field.name }}-0').attr('id', 'selector-btn-{{ field.name }}-' + idx);
                                            newEntry.find('#add-{{ field.name }}-0').attr('id', 'add-{{ field.name }}-' + idx).attr('idx',idx);
                                            newEntry.find('#input-{{ field.name }}-0').attr('id', 'input-{{ field.name }}-' + idx);
                                            newEntry.find('button.dx-g-bs4-filter-selector-item').attr('parent', 'selector-btn-{{ field.name }}-' + idx);
                                            newEntry.find('#input-{{ field.name }}-0').attr('id', 'input-{{ field.name }}-' + idx);
                                            newEntry.find('.data-input').removeClass('hasDatepicker').val('');
                                            newEntry.appendTo(controlForm);

                                            flt_counts['{{ field.name }}'] += 1;
                                        }
                                    } else {
                                        idx = +$(this).attr('idx') + 1;
                                        cnt = flt_counts['{{ field.name }}'];
                                        flt_counts['{{ field.name }}'] = idx;
                                        for (var i = idx; i < cnt; i++) {
                                            ig = '#input-group-{{ field.name }}-' + i;
                                            $(ig).remove();
                                        }
                                        e.preventDefault();
                                        return false;
                                    }
                                });
                            });
                            </script>
                        </div>
                        </div>
                    </li>

                {% endfor %}
            </ul>
        </div>
    </div>
    </div>

    <script>
        $('#{{ group.grouper.id }}_gcheck').on('click', function () {
            // При нажатии на кнопку Выбрать ВСЕ - выделяем или снимаем выделение со всех полей
            is_active = $('#{{ group.grouper.id }}_gcheck').hasClass('active');
            if (is_active) {
                $('.btn-df[data-type="check"][data-group="{{ group.grouper.id }}"]').removeClass('active');
            } else {
                 $('.btn-df[data-type="check"][data-group="{{ group.grouper.id }}"]').addClass('active');
            };
        });
        $('#{{ group.grouper.id }}_gfilter').on('click', function () {
            // При нажатии на кнопку Выбрать ВСЕ - выделяем или снимаем выделение со всех полей
            is_active = $('#{{ group.grouper.id }}_gfilter').hasClass('active');
            if (is_active) {
                $('.btn-df[data-type="filter"][data-group="{{ group.grouper.id }}"]').removeClass('active');
            } else {
                 $('.btn-df[data-type="filter"][data-group="{{ group.grouper.id }}"]').each(function() {
                         var field_name = $(this).attr('field_name');
                         var cnt = flt_counts[field_name];
                         var valid_flag = 1;
                         for (var i = 0; i < cnt; i++) {
                             input_data = $('#input-' + field_name + '-' + i).val();
                             if (input_data == '' || input_data == null) {
                                 valid_flag = 0;
                                 break;
                             };
                         }
                         if (valid_flag) {
                             $('#' + field_name + '_filter').addClass('active');
                         };
                 });

            };
        });

    </script>

    {% endfor %}
</div>

<script>
$(document).on('change', '.data-input', function(event) {
  var field_name = $(this).attr('field_name');
  var cnt = flt_counts[field_name];
  var valid_flag = 1;
  for (var i=0; i<cnt; i++ ) {
      input_data = $('#input-' + field_name + '-' + i ).val();
      if (input_data=='' || input_data==null ) { valid_flag = 0; break; };
  }
  if (valid_flag) {
      $('#' + field_name + '_filter').addClass('active');
  } else {
      $('#' + field_name + '_filter').removeClass('active');
  }
});

$(document).on('click', '.dx-g-bs4-filter-selector-item', function(event) {
    var pic = $(this).find("svg")[0].outerHTML;
    var action = $(this).attr("action");
    $( '#'+$(this).attr('parent') ).html(pic);
    $( '#'+$(this).attr('parent') ).attr("action", action)
});

$(document).on('focus','.date-control', function(){
    if( $(this).hasClass('hasDatepicker') === false )  {
        $(this).datepicker({
            language: 'ru',
            dateFormat: "dd.mm.yy",
            monthNames : ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'],
            dayNamesMin : ['Вс','Пн','Вт','Ср','Чт','Пт','Сб'],
        });
    }
});

function isInteger(evt) {
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode > 31  && (charCode < 48 || charCode > 57))
    return false;
    return true;
};

function isDecimal(evt) {
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57))
    return false;
    return true;
}

</script>

{% endblock %}